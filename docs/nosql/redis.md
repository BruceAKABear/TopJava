# redis

## 16384 个槽位

crc 算法后取模 16384 得到最后的集群中

## redis 工作原理

## redis 的单线程模型，为什么 redis 单线程速度还那么快？

文件事件处理器是单线程的，

单线程加多路 io 复用技术

单线程多路 io 复用，在单线程中是没有阻塞的

io 复用又 select、poll\epoll 三种模式

利用一个线程检测 socket 的就绪状态

## 命令

set a 1
get a
keys \*
exists a
del a

expire a 10
ttl a

dbsize

flushdb

flushall

## list

双向链表，头插 lpush/尾插/rpush 性能高

弹出获取操作，lpop/rpop key

## 淘汰策略

## lru 算法和 ttl 算法

lru 最近最少使用算法

两种算法都是不精确的，是估算的

## 事务

redis 的事务更像一组指令需要一起完成，中间不允许其他的指令执行

如果报告错误，比如命令用错了单词写错了，会取消事务

如果执行阶段错误（比如对字符串进行 incr 加法），其他命令还是会执行，不会回滚

## 持久化

rdb 持久化存储数据，恢复数据块

fork 一个进程，先将数据写入零时文件，待持久化过程结束以后用零时文件替换上次持久化文件

一般情况下父子进程公用内存，需要持久化时从父进程复制内容给子进程

写时复制

如果不满足保存策略那么最后一次快照数据异常关闭数据会丢失

恢复数据的话直接拷贝到目录下启动就可行

rdb 节省空间

aof 持久化

以日志的形式记录所有写操作，追加文件，redis 启动后会读取文件重新构建数据
可以通过 rewrite 只保存最小指令

默认不开启，

占用空间大

如果同时开启，aof 优先级最高

官方推荐两个同时用，如果单单缓存直接不用持久化

## sentinel 哨兵模式

自动选择一台主服务器

必须要在主从复制模式

选主条件：1.优先级靠前的 2.获取原主数据最多的 3.每个 redis 启动后会生成 40 为 uuid,uuid 最小的
